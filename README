CGC Website Repository
===========================

This repository contains the CGC Web application.

Installation
------------

 > cd local/perl/path
 > perl -Mlocal::lib=./
 > eval $(perl -Mlocal::lib=./)
 > cd $approot
 > perl Makefile.PL
 > make installdeps
 > mysql -u user -ppassword -e 'create database cgc_YYYYMMDD'
 > mysql -u -p cgc_YYYYMMDD < schema/cgc.sql
 > mysql -u -p cgc_YYYYMMDD < util/sql/user_database.sql
 (You'll either need to make a symlink for cgc-[DATE] -> cgc in your data directory
  or change the name of the database in your configuration file)

# Get bootstrap
git submodule update --init


Prepopulate the database
-----------------------------------

1. Set up your environment

 export CGC_DB=cgc
 # We version this directory by YYYY.MM.DD below. Adjust
 # as appropriate here.
 export IMPORT_DIR=/path/to/foxpro_dumps/TSV
 
 # Full path to your dbic.conf file
 export CGC_DBIC_CONF=/path/to/app/dbic.conf

2. Create and initialize a new database

 # Create a new database
 > mysqladmin create $CGC_DB
  
 # Initialize the schema
 > mysql $CGC_DB < schema/cgc.sql


3. Get foxpro data dumps from the CGC

 > mkdir data/YYYY-MM-DD
 > cd YYYY-MM-DD
 > mkdir foxpro foxpro_tsv wormbase
 > cd foxpro
 // Minimally get the following files from the CGC (manually, from Aric)
 cgcmail.txt frzloc.txt gophstrnt.txt lablist.txt transrec.txt
 > cp gophstrn.txt ../foxpro_tsv/strain.ego


4. Convert FoxPro data dumps to a useable format

 > cd $APP/util/import
 > ./foxpro_parser.pl $APP/data/YYYY.MM.DD/foxpro/cgcmail.txt > \
      $APP/data/YYYY.MM.DD/foxpro_tsv/cgcmail.tsv
 > ./foxpro_parser.pl $APP/data/YYYY.MM.DD/foxpro/frzloc.txt > \
      $APP/data/YYYY.MM.DD/foxpro_tsv/frzloc.tsv
 > ./foxpro_parser.pl $APP/data/YYYY.MM.DD/foxpro/lablist.txt > \
      $APP/data/YYYY.MM.DD/foxpro_tsv/lablist.tsv
 > ./foxpro_parser.pl $APP/data/YYYY.MM.DD/foxpro/transrec.txt > \
      $APP/data/YYYY.MM.DD/foxpro_tsv/transrec.tsv

5. Load data from WormBase into our database.

   (See util/import/wormbase/README for additional information)

 # The order these scripts are run in is important.
 > cd util/import/wormbase
 > ./load_species.pl
 > ./load_gene_classes.pl
 > ./load_laboratories.pl
 > ./load_strains.pl
 > ./load_variations.pl
 > ./load_transgenes.pl
 > ./load_rearrengements.pl
 > ./load_genes.pl

6. Merge (or simply import) CGC data

If you've loaded data from WormBase, you'll need to merge
data
 > util/import/merge_cgc_data.pl --verbose 2 --dir $IMPORT_DIR

Otherwise, simply import
 > export IMPORT_DIR=$APP/data/YYYY.MM.DD/foxpro_tsv
 > ./util/import/import.pl --verbose 2 --dir $IMPORT_DIR









Running the application
-----------------------

To run the app using the built-in Catalyst server:

> ./script/cgc_server.pl -p 8000

For more control you can use your own configuration:

> CGC_CONFIG_LOCAL_SUFFIX=tharris ./script/cgc_server.pl -p 8000

This will use configuration in $approot/cgc_tharris.conf
to override the default cgc.conf file.


Running the application via Starman
-----------------------------------

 > script/cgc-init.sh

Todd Harris (todd@hiline.co)